---
title: "Final Report: The COVID-19 Pandemic, Public Health Restrictions, and Mental Health"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Katherine Beltz, Matt Mohn, Melannie Nimocks"
date: "11/16/2021"
output: pdf_document
---

```{r load-packages, message = FALSE, warning = FALSE, echo = FALSE}
library(tidyverse) 
library(readxl)
library(lubridate)
library(tidymodels)
library(knitr)
library(xtable)
``` 
# Introduction and Data

  From the beginning of the COVID-19 pandemic until now, the global community has suffered social, economic, and medical burdens in unprecedented levels. Though the physical health of individuals has been of paramount concern due to the high infectivity of COVID-19, with 237.88 million cases and 4.85 million deaths in as of October 2021, another burden on individuals, governments, and health systems has manifested itself in the form of rapidly deteriorating mental health (Our World in Data, 2021). It has been widely accepted that as the COVID-19 pandemic has progressed, mental health has decreased (Centers for Disease Control and Prevention, 2021). However, there is a much less comprehensive body of data surrounding how certain mitigation efforts specifically have impacted mental health. For example, the Centers for Disease Control and Prevention (2021) acknowledge that social distancing may increase loneliness, stress, and anxiety, but it is less understood if masking is more directly correlated to obsessive compulsive disorder than it is to depression. Therefore, there is a need to fully understand these intricate relationships in order to drive efforts towards creating more individualized mental health treatments, as well as being able to predict what kind of mental health treatment will be needed in response to an increase in any given public health restriction.
  
Our data analysis will answer the following research question: how do different COVID-19 mitigation efforts correlate to different types of mental illnesses? In doing so, our project will begin to uncover how certain restrictions may impact different mental illness depending on restriction type. Our project will make use of two data sets and merge the data sets based on country in order to ensure there are sufficient relationships to explore in the data. The first data set is of the frequency of different search topics related to mental health from January of 2019 through September of 2021 for a variety of countries (Google Trends, 2021). The data was collected from Google Trends and records the relative popularity of that search topic for any given week in a given country. This data set will be used to gauge how concern with certain mental health topics, including anxiety, depression, panic attacks, obsessive compulsive disorder, and insomnia, has changed over the course of the pandemic. The second data set tracks implementation of COVID-19 mitigation efforts in different countries (Zosimov, 2021). This data set was originally derived from the World Health Organizationâ€™s tracking of public health and social measures, and indices were calculated on the raw data in order to quantify the intensity of the restriction, such as masks, gatherings, businesses, schools, or travel. This data has daily measurements from January 2020 through September of 2020. The union of this data set with the previous will enable the exploration of any possible correlation between public health and social measures and mental health as measured by relative mental health search topic frequency.

```{r load-data, message = FALSE, echo = FALSE}
setwd('../')
restrictions_worldwide <- readr::read_csv("data/phsm-severity-data-short.csv")
google_trends <- readr::read_csv("data/google_trends_data_c.csv")

```

#Exploratory Data Analysis

  Through a series of data tidying and wrangling steps, the data has been joined on both country and date. In order to do so, column names and data formats had to first be modified in order to ensure the column titles match across the data sets. Any duplicate columns that resulted from the merge were removed. Since the search terms are weekly observations whereas restrictions are daily observations, the search term frequency will be kept constant throughout the week, but each observation for restrictions will be observed for changes. This will enable our analysis to observe how daily changes may affect weekly averages without altering or extrapolating data. 
  Shown below is a glimpse of the resulting data set.

```{r clean-data, echo=FALSE}
# for each dataset, make the countries standardized
restrictions_worldwide$COUNTRY <- gsub("United States Of America", "United States", restrictions_worldwide$COUNTRY)

restrictions_worldwide$COUNTRY <- gsub("United Kingdom Of Great Britain And Northern Ireland", "United Kingdom", restrictions_worldwide$COUNTRY)


google_trends <- 
  google_trends %>%
  mutate(COUNTRY = nation) %>%
  mutate(DATE_START = week)


match_dates<-merge(restrictions_worldwide, google_trends, by=c("COUNTRY","DATE_START")) 

new_set <- 
  match_dates %>%
  select(-c(week, nation))

new_set <- new_set %>%
  mutate(date = mdy(DATE_START))
```

```{r glimpse-data, message = F, echo=FALSE}

glimpse(new_set)

```

Preliminary data analysis included summary statistics, namely, the mean and standard deviation for each mental health search term relative frequency grouped by country. For the purposes of making sure analysis was feasible, five countries of interest were selected for this report: Brazil, India, Mexico, The United States, and New Zealand. Such countries were chosen in order to provide a wide range of COVID conditions, as many of these countries approached COVID mitigation differently. This provided a baseline understanding of what mental illnesses may be more or less prevalent in each country, disregarding any public health social measures, over the period of study from January 2020 through September 2020.

As seen in the Summary Statistic Tables below, anxiety as a search topic has the lowest mean frequency over the period of study. Therapy appears to have the highest mean frequency over the period of study. Interestingly, insomnia and depression as search topics have the greatest range of mean frequencies between each country. For insomnia, there is a range of about 53 points, with the minimum score from Italy and the maximum score from the United States. The United States also holds the highest score for depression search frequency, with a low from India, resulting in a range of 59.

It is important to note that the standard deviations for many of these measurements is fairly high. This is to be expected since the measurements are taken over a time period of rapidly changing social distancing policies and COVID severity across the globe. Further statistical analyses in this report determine how much this affects our understanding of this data.

```{r summary_stats, echo=FALSE}

summary_stat <-
  data.frame(depression_mean = aggregate(depression ~ COUNTRY, new_set, mean),
             depression_sd = aggregate(depression~COUNTRY, new_set, sd),
             anxiety_mean = aggregate( anxiety ~ COUNTRY, new_set, sd ),
             anxiety_sd = aggregate(anxiety~COUNTRY, new_set, sd),
             ocd_mean = aggregate( ocd ~ COUNTRY, new_set, mean ),
             ocd_sd = aggregate(ocd~COUNTRY, new_set, sd),
             insomnia_mean = aggregate( insomnia ~ COUNTRY, new_set, mean ),
             insomnia_sd = aggregate(insomnia~COUNTRY, new_set, sd),
             therapy_mean = aggregate( therapy ~ COUNTRY, new_set, mean ),
             therapy_sd = aggregate(therapy~COUNTRY, new_set, sd)
)

summary_stat <- subset(summary_stat, select = -c(                     
                                                  depression_sd.COUNTRY, 
                                                 anxiety_mean.COUNTRY, 
                                            anxiety_sd.COUNTRY, ocd_mean.COUNTRY, 
                      ocd_sd.COUNTRY,insomnia_mean.COUNTRY,insomnia_sd.COUNTRY, 
                      therapy_mean.COUNTRY,therapy_sd.COUNTRY) )


summary_stat<-(rename(summary_stat, COUNTRY=depression_mean.COUNTRY))

summary_stat_b <- summary_stat %>% 
  select(COUNTRY, depression_mean.depression, depression_sd.depression, anxiety_mean.anxiety, 
         anxiety_sd.anxiety)

summary_stat_b <- 
  summary_stat_b %>% 
  rename(nation = COUNTRY, 
         depression_mean = depression_mean.depression, 
         depression_sd = depression_sd.depression, 
         anxiety_mean = anxiety_mean.anxiety, 
         anxiety_sd = anxiety_sd.anxiety)

summary_stat_c <- 
  summary_stat %>% select(COUNTRY, therapy_mean.therapy, therapy_sd.therapy, 
                          insomnia_mean.insomnia, insomnia_sd.insomnia, ocd_mean.ocd, ocd_sd.ocd)

summary_stat_c <- 
  summary_stat_c %>% rename(nation = COUNTRY, 
                            therapy_mean = therapy_mean.therapy, 
                            therapy_sd = therapy_sd.therapy, 
                            insomnia_mean = insomnia_mean.insomnia, 
                            insomnia_sd = insomnia_sd.insomnia, 
                            ocd_mean = ocd_mean.ocd, 
                            ocd_sd = ocd_sd.ocd)

knitr::kable(summary_stat_b,digits=3,caption="Summary Statistics for Depression and Anxiety") 

knitr::kable(summary_stat_c,digits=3,caption="Summary Statistics for Therapy, Insomnia and OCD")

```

As the next step in exploratory data analysis, the graph below was created to examine mental health search terms as a function of time, regardless of any COVID restrictions or of any specific country. This graph was made for all search terms, but it was found that the graph for OCD search topic frequency provided the most insight into how individuals' mental state shifted during the pandemic. By using geom_smooth, the line on the plot demonstrates a slight increase in frequency of searching for OCD during the first wave of COVID. From a qualitative standpoint, this increase would align with the notion that individuals became concerned with signs of OCD as much of the population became highly obsessive over cleanliness, which is often understood as OCD in the general population despite this definition being slightly inaccurate. It could also be due to individuals demonstrating signs of a compulsive need to follow certain rituals in order to feel safe from COVID. 

Statistical analysis provided further in the report explores the significance, if any, of this increase.

```{r dataviz, message=FALSE, warning=FALSE, fig.height = 3, echo=FALSE}

natl_avg <- google_trends %>% 
  mutate(tidytime = mdy(DATE_START), ocd2 = as.integer(ocd), insomnia2 = as.integer(insomnia)) %>% 
  filter(tidytime < mdy("1/1/2020")) %>% 
  group_by(COUNTRY) %>% 
  summarise(Ndepression = mean(depression), Nocd2 = mean(ocd2), Nanxiety = mean(anxiety), Ninsomnia2 = mean(insomnia2), Ntherapy = mean(therapy))

lim_set <- merge(new_set, natl_avg, by=c("COUNTRY")) %>% 
  mutate(relative_ocd = 100 * as.integer(ocd) / Nocd2, relative_depression = 100 * 
  as.integer(depression) / Ndepression, relative_anxiety = 100 * as.integer(anxiety) / Nanxiety, 
  relative_insomnia = 100 * as.integer(insomnia) / Ninsomnia2, relative_therapy = 100 * 
  as.integer(therapy) / Ntherapy)

graph_set <- 
  lim_set %>% 
  filter(mdy(DATE_START) > mdy("3/1/2020"), mdy(DATE_START) < mdy("7/1/2020")) %>% 
  select(DATE_START, relative_ocd)

ggplot(data = graph_set, mapping = aes(x = mdy(DATE_START), y = relative_ocd)) + 
  geom_point() + 
  geom_smooth() + 
  ylim(50,250) + 
  labs(x = "Date (2020)", 
       y = "Search frequency for 'ocd'", 
       title ="OCD Searches Spiked In First COVID Wave", 
       subtitle = "100 = 2019 mean")
```
# Methodology and Results

In order to conduct analysis, mental health search topic relative popularity was examined as explained by the index of public health measure severity. Mental health search topic popularity was used as an indicator for mental illness prevalence during a given time frame, and was analyzed alongside restriction intensity for the same time frame. This relationship was explored across various countries in order to account for the differences in public health measures that each government enacted throughout the course of the pandemic.

Five countries in our data set were chosen as focus: Brazil, India, Mexico, The United Sates, and New Zealand. We first focused on quantifying the relationship between one mental health burden, as quantified by search topic frequency, and different types of restrictions. This was examined using multiple linear regression models where the response variable was relative mental illness search topic frequency conditioned on all of the different COVID restrictions. This was done for all search terms for each of the five countries. Once all the regression models were created, any model with 3 or more significant explanatory variable estimates (p-value <0.05) was selected for further evaluation.

```{r create-data-sets, message=FALSE, warning=FALSE, echo = FALSE}

US_data <- lim_set %>%
  filter(COUNTRY == "United States")

Brazil_data <- lim_set %>%
  filter(COUNTRY == "Brazil")

Mexico_data <- lim_set %>%
  filter(COUNTRY == "Mexico")

NewZealand_data <- lim_set %>%
  filter(COUNTRY == "New Zealand")

India_data <- lim_set %>%
  filter(COUNTRY == "India")


```

```{r final-regs, message=FALSE, warning=FALSE, echo = FALSE}
# United States

US_relative_therapy_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_therapy ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = US_data)

US_relative_therapy_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: USA, Search: Therapy") 

US_relative_anxiety_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_anxiety ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = US_data)

US_relative_anxiety_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: USA, Search: Anxiety") 

# Brazil

Brazil_relative_ocd_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_ocd ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Brazil_data)

Brazil_relative_ocd_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Brazil, Search: OCD")

Brazil_relative_therapy_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_therapy ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Brazil_data)

Brazil_relative_therapy_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Brazil, Search: Therapy") 

# Mexico

Mexico_dep_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_depression ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Mexico_data)

Mexico_dep_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Mexico, Search: Depression") 

Mexico_relative_insomnia_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_insomnia ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Mexico_data)

Mexico_relative_insomnia_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Mexico, Search: Insomnia") 

# India

India_relative_insomnia_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_insomnia ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = India_data)

India_relative_insomnia_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: India, Search: Insomnia") 

```

```{r US-reg, message=FALSE, warning=FALSE, eval=FALSE, include=FALSE, echo = FALSE}

US_relative_ocd_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_ocd ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = US_data)

US_relative_ocd_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: USA, Search: OCD") 

US_dep_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_depression ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = US_data)

US_dep_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: USA, Search: Depression") 

US_relative_insomnia_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_insomnia ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = US_data)

US_relative_insomnia_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: USA, Search: Insomnia") 

```

```{r Brazil-reg, message=FALSE, warning=FALSE, eval=FALSE, include=FALSE, echo = FALSE}

Brazil_dep_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_depression ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Brazil_data)

Brazil_dep_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Brazil, Search: Depression") 


Brazil_relative_anxiety_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_anxiety ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Brazil_data)

Brazil_relative_anxiety_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Brazil, Search: Anxiety") 

Brazil_relative_insomnia_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_insomnia ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Brazil_data)

Brazil_relative_insomnia_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Brazil, Search: Insomnia") 
```

```{r Mex-reg, warning = FALSE, message = FALSE, include = FALSE, echo = FALSE}

Mexico_relative_ocd_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_ocd ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Mexico_data)

Mexico_relative_ocd_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Mexico, Search: OCD") 


Mexico_relative_therapy_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_therapy ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Mexico_data)

Mexico_relative_therapy_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Mexico, Search: Therapy") 

Mexico_relative_anxiety_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_anxiety ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = Mexico_data)

Mexico_relative_anxiety_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: Mexico, Search: Anxiety") 

```


```{r New-reg, message=FALSE, warning=FALSE, include = FALSE, echo = FALSE}

NewZealand_relative_ocd_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_ocd ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = NewZealand_data)

NewZealand_relative_ocd_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: New Zealand, Search: OCD") 

NewZealand_dep_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_depression ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = NewZealand_data)

NewZealand_dep_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: New Zealand, Search: Depression") 

NewZealand_relative_therapy_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_therapy ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = NewZealand_data)

NewZealand_relative_therapy_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: New Zealand, Search: Therapy") 

NewZealand_relative_anxiety_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_anxiety ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = NewZealand_data)

NewZealand_relative_anxiety_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: New Zealand, Search: Anxiety") 

NewZealand_relative_insomnia_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_insomnia ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = NewZealand_data)

NewZealand_relative_insomnia_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: New Zealand, Search: Insomnia") 
```

```{r Ind-reg, message=FALSE, warning=FALSE, include = FALSE, echo = FALSE}

India_relative_ocd_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_ocd ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = India_data)

India_relative_ocd_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: India, Search: OCD") 

India_dep_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_depression ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = India_data)

India_dep_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: India, Search: Depression") 

India_relative_therapy_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_therapy ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = India_data)

India_relative_therapy_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: India, Search: Therapy") 

India_relative_anxiety_reg <- linear_reg() %>%
  set_engine("lm") %>%
  fit(relative_anxiety ~ MASKS + TRAVEL + GATHERINGS + SCHOOLS + BUSINESSES + MOVEMENTS, data = India_data)

India_relative_anxiety_reg %>%
  tidy(conf.int = TRUE) %>%   knitr::kable(digits=4,caption="Nation: India, Search: Anxiety") 

```
The residual plots below were created to understand any concern over the linear regression models applied to the data. Residual plots were only created for models that showed significant findings, as these are the data sets the rest of the interpretation will primarily focus on. 

None of the residual plots have a clear pattern. Although some of the residual plots are slightly concentrated on one side of the plot, there is still no discernible pattern in the variation, indicating that the models are appropriate for the data.

Next to each residual plot is the corresponding scatter plot with the regression line fitted to the data. The significance of these relationships will be further explored from the results of regression analysis.

```{r residualPlot1, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}

US_therapy_aug <- augment(US_relative_therapy_reg$fit)

ggplot(US_therapy_aug, mapping = aes(x = .fitted, y = relative_therapy)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Therapy Searches in USA", y = "Actual")


ggplot(US_therapy_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Therapy Searches in USA", y = "Residuals")

```

```{r residualPlot2, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}
US_anxiety_aug <- augment(US_relative_anxiety_reg$fit)

ggplot(US_anxiety_aug, mapping = aes(x = .fitted, y = relative_anxiety)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Anxiety Searches in USA", y = "Actual")

ggplot(US_anxiety_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Anxiety Searches in USA", y = "Residuals")

```

```{r residualPlot3, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}
Brazil_ocd_aug <- augment(Brazil_relative_ocd_reg$fit)

ggplot(Brazil_ocd_aug, mapping = aes(x = .fitted, y = relative_ocd)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted OCD Searches in Brazil", y = "Actual")

ggplot(Brazil_ocd_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted OCD Searches in Brazil", y = "Residuals")

```

```{r residualPlot4, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}
Brazil_therapy_aug <- augment(Brazil_relative_therapy_reg$fit)

ggplot(Brazil_therapy_aug, mapping = aes(x = .fitted, y = relative_therapy)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Therapy Searches in Brazil", y = "Actual")

ggplot(Brazil_therapy_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Therapy Searches in Brazil", y = "Residuals")
```

```{r residualPlot5, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}

Mexico_dep_aug <- augment(Mexico_dep_reg$fit)

ggplot(Mexico_dep_aug, mapping = aes(x = .fitted, y = relative_depression)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Depression Searches in Mexico", y = "Actual")+
  theme(text=element_text(size=10))

ggplot(Mexico_dep_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Depression Searches in Mexico", y = "Residuals")+
  theme(text=element_text(size=10))

```

```{r residualPlot6, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}
Mexico_insomnia_aug <- augment(Mexico_relative_insomnia_reg$fit)

ggplot(Mexico_insomnia_aug, mapping = aes(x = .fitted, y = relative_insomnia)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Insomnia Searches in Mexico", y = "Actual")+
  theme(text=element_text(size=10))

ggplot(Mexico_insomnia_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Insomnia Searches in Mexico", y = "Residuals")+
  theme(text=element_text(size=10))
```

```{r residualPlot7, warning=FALSE, message=FALSE, echo = FALSE, fig.height = 2.5, fig.width = 3}

India_insomnia_aug <- augment(India_relative_insomnia_reg$fit)

ggplot(India_insomnia_aug, mapping = aes(x = .fitted, y = relative_insomnia)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method="lm") +
  labs(x = "Predicted Insomnia Searches in India", y = "Actual")

ggplot(India_insomnia_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Predicted Insomnia Searches in India", y = "Residuals")

```

The confidence intervals and statistical significance of each variable were then examined. Multiple linear regression models were chosen for analysis in order to evaluate how the different restrictions, measured through a global index, affect the relative search popularity of mental health topic. This form of analysis was used for the purpose of determining which restrictions have a significant effect in determining the relative search popularity for a specific mental health term. 5 multiple regression models--one for each mental health search topic being evaluated for this study--were fit for each of the five countries chosen for analysis. Mental health search topic relative frequency was set as the response variable and the different restrictions were set as explanatory variables. 

As previously explained, for the purposes of concision, only models with 3 or more significant explanatory variable estimates (p-value < 0.05) was selected for further evaluation. The null hypothesis for each of these tests is that there is no relationship between a certain mental health search topic and type of restriction. When the p-value is less than 0.05, we are able to reject the null hypothesis that there is no relationship between a given mental health search topic and a given restriction. When the p-value is greater than 0.05, we fail to reject the null hypothesis, and cannot conclude that there is any relationship between a given mental health search topic and a given restriction. This hypothesis was evaluated via multiple regression as follows, where only the factors that allowed for the rejection of the null hypothesis are examined.

USA-THERAPY:
This regression model evaluates the effects of different restrictions on searches for therapy in the United States. Restrictions with significant p-values (< 0.05) in this model are masks, gatherings, schools, and businesses. Masking restrictions have an estimate of 0.0706 (95% CI = (0.0285,0.1128)), gatherings restrictions have an estimate of 0.1804 (95% CI = (0.0450,0.3157)), and business restrictions have an estimate of 0.0994 (95% CI = (0.0476, 0.1512)). The positive estimates from these data demonstrate that an increase in restrictions in masking, gatherings and businesses leads to an increase in therapy searches in the US. School restrictions have an estimate of -0.2416 (95% CI= (-0.3887, -0.0945)). This negative estimate suggests that an increase in school restrictions leads to a decrease in therapy searches in the US. (make sure this is explained in conclusion)

USA-ANXIETY:
This regression model evaluates the effects of different restrictions on searches for anxiety in the United States. Restrictions with significant p-values (< 0.05) in this model are masks, schools, and businesses. Masking restrictions have an estimate of 0.0706 (95% CI = (0.0283,0.1129) and business restrictions have an estimate of 0.0693 (95% CI = (0.0173, 0.1213)). These positive estimates demonstrate that an increase in restrictions in masking and businesses leads to an increase in anxiety searches in the US. School restrictions have an estimate of -0.1738 (95% CI= (-0.3214, -0.0262)). This suggests that an increase in school restrictions leads to a decrease in anxiety searches in the US.

BRAZIL-OCD:
This regression model evaluates the effects of different restrictions on searches for OCD in Brazil. Restrictions with significant p-values (< 0.05) in this model are masks, schools, and movements. Masking restrictions have an estimate of 0.1732 (95% CI = (0.0230,0.3234)), movements restrictions have an estimate of 0.1870 (95% CI = (0.0490,0.3251)). These positive estimates demonstrate that an increase in restrictions in masking and movements leads to an increase in therapy searches in the US. School restrictions have an estimate of -0.6105 (95% CI= (-0.9806, -0.2404)). This negative estimate suggests that an increase in school restrictions leads to a decrease in OCD searches in Brazil.

BRAZIL-THERAPY:
This regression model evaluates the effects of different restrictions on searches for therapy in Brazil. Restrictions with significant p-values (< 0.05) in this model are masks, gatherings, travel, and businesses. Masking restrictions have an estimate of 0.1889 (95% CI = (0.1203,0.2575), gatherings restrictions have an estimate of -0.1496 (95% CI = -0.2911,-0.0082), travel restrictions have an estimate of -0.0760 (95% CI = (-0.1246, -0.0275)), and business restrictions have an estimate of -0.0862 (95% CI = (-0.1429, -0.0294)). These data suggest that an increase in restrictions in masking leads to an increase in therapy searches in Brazil, while an increase in restrictions in gatherings, travel, and businesses leads to a decrease in therapy searches in Brazil.

MEXICO-DEPRESSION:
This regression model evaluates the effects of different restrictions on searches for depression in Mexico. Restrictions with significant p-values (< 0.05) in this model are masks, gatherings, schools, and movements. Masking restrictions have an estimate of 0.5112 (95% CI = (0.2141,0.8084)), movement restrictions have an estimate of -0.6979 (95% CI = (-1.094,0.3251)), gathering restrictions have an estimate of 0.4850 (95% CI = (0.1803,0.7898)), and school restrictions have an estimate of -1.0561 (95% CI = (-1.8064,-0.3057)). These data suggest that in Mexico an increase in restrictions in masking and gatherings leads to an increase in depression searches, while an increase in restrictions in schools and movements leads to a decrease in depression searches.

MEXICO-INSOMNIA:
This regression model evaluates the effects of different restrictions on searches for insomnia in Mexico. Restrictions with significant p-values (< 0.05) in this model are masks, travel, schools, and movements. Masking restrictions have an estimate of -1.7312 (95% CI = (-2.2505,-1.2118)), movement restrictions have an estimate of 1.6124 (95% CI = 0.9143,2.3106), travel restrictions have an estimate of 0.1912 (95% CI = (0.0200,0.3624)), and school restrictions have an estimate of 3.9493 (95% CI = (-2.6381,5.2606)). These data suggest that in Mexico an increase in restrictions in movement, travel, and school leads to an increase in insomnia searches, while an increase in masking leads to a decrease in insomnia searches.

INDIA-INSOMNIA:
This regression model evaluates the effects of different restrictions on searches for insomnia in India. Restrictions with significant p-values (< 0.05) in this model are masks, gatherings, and school. Masking restrictions have an estimate of 0.5406 (95% CI = (0.0293,1.0519)), gathering restrictions have an estimate of 0.6567 (95% CI = 0.1813,1.1321)), and school restrictions have an estimate of -2.2563 (95% CI = (-3.2595,-1.2531)). These data suggest that in Mexico an increase in restrictions in masking and gatherings leads to an increase in insomnia searches, while an increase in school restrictions leads to a decrease in insomnia searches.

These regression models helped us better understand the relationship between certain restrictionsâ€™ severity and the number of searches for a mental health term. Out of the 20 models that had data for masking, 12 showed significant p-values (< 0.05) for mask restrictions, and 11 of those showed a positive estimate. Out of the 25 models that had data for travel, 6 showed significant p-values, and 3 of those showed a positive estimate. Out of the 25 models that had data for gatherings, 7 showed significant p-values, and 3 of those showed a positive estimate. Out of the 25 models that had data for schools, 13 showed significant p-values, and 4 of those showed a positive estimate. Out of the 25 models that had data for businesses, 6 showed significant p-values, and 3 of those showed a positive estimate. Out of the 25 models that had data for movements, 4 showed significant p-values, and 3 of those showed a positive estimate. The only restrictions where a majority of the regression models showed significance are masking and school. Furthermore, 11 out of 12 significant masking values were positive, demonstrating that an increase in masking generally demonstrated an increase in searches for mental health terms. For the school restrictions, 9 out of 13 significant school values were negative, demonstrating that an increase in school restrictions generally demonstrated a decrease in searches for mental health terms. 

##need to explain this in terms of research question to make sure to answer the question. talk about what specific mental health search terms are more impacted by a specific restriction. include discussion on what that means for understanding mental health treatments and needs during pandemics.

There are various limitations to our analysis that must be considered in order to fully understand how the conclusions apply. Some of these limitations come from considering how data was collected, particularly from Google Trends. Firstly, Google Trends measures searches relative to all other searches, and is not a nominal measure of the amount of searches being done. This adds noise to our model and may therefore skew our multiple regression models. For example, search terms for depression could have doubled but the relative score of its frequency would not change significantly if other search terms increased as well. Additionally, though the point of this report was to examine mental health concern as a function of search terms, they may not be fully indicative of actual mental health, especially considering that the search terms had to be broadened into topics in order to account for language differences. In terms of the restrictions data set, the indices are compressed into one score for an entire country, which does not account for local differences. Lastly, there may be correlations within the predictor variables (restrictions) that were outside the scope of our initial research.

In general, modeling never accounts for every single factor that could contribute to explaining a response variable. There may be some factors in our model that are impacted by confounding variables or extra noise in the data set, as explained above. This is why they are models and not static measurements. Though this report has outlined interesting possibilities in terms of the relationship between mental health concern and COVID restrictions, it is important to understand the limitations in both data collection and modeling for a relationship as complex as this one. 

# References

Centers for Disease Control and Prevention. (2021). Coping with stress. Centers for Disease 
Control and Prevention. Retrieved October 11, 2021, from https://www.cdc.gov/mentalhealth/stress-coping/cope-with-stress/index.html?CDC_AA_refVal=https%3A%2F%2Fwww.cdc.gov%2Fcoronavirus%2F2019-ncov%2Fdaily-life-coping%2Fmanaging-stress-anxiety.html.

Google Trends. Google Trends, Google. (2021). Retrieved November 5, 2021, from 
https://trends.google.com/trends/?geo=US. 

Our World in Data. Cumulative confirmed covid-19 cases and deaths. Our World in Data. (n.d.). 
Retrieved October 11, 2021, from https://ourworldindata.org/grapher/
cumulative-deaths-and-cases-covid-19.

Zosimov, R. (2021, September). COVID-19: Public Health Social Measures, Version 1. 
Retrieved October 11, 2021, from https://www.kaggle.com/hijest/covid19-public-health
-social-measures/metadata.


